<script>
  const userTable = document.getElementById("userTable");
  const filterRole = document.getElementById("filterRole");

  function getUsers() {
    return JSON.parse(localStorage.getItem("users") || "[]");
  }

  function setUsers(users) {
    localStorage.setItem("users", JSON.stringify(users));
  }

  function renderUsers(role = "") {
    const users = getUsers();
    userTable.innerHTML = "";
    users
      .filter(user => !role || user.role === role)
      .forEach((user, index) => {
        userTable.innerHTML += `
          <tr class="border-b">
            <td class="p-2">${index + 1}</td>
            <td class="p-2">${user.name}</td>
            <td class="p-2">${user.cnic}</td>
            <td class="p-2 capitalize">${user.role}</td>
            <td class="p-2">
              <button class="text-blue-600 hover:underline mr-2" onclick="editUser(${index})">Edit</button>
              <button class="text-red-600 hover:underline" onclick="deleteUser(${index})">Delete</button>
            </td>
          </tr>`;
      });
  }

  document.getElementById("addUserForm").addEventListener("submit", (e) => {
    e.preventDefault();
    const name = document.getElementById("userName").value.trim();
    const cnic = document.getElementById("userCNIC").value.trim();
    const password = document.getElementById("userPassword").value;
    const role = document.getElementById("userRole").value;

    const users = getUsers();
    users.push({ name, cnic, password, role });
    setUsers(users);
    renderUsers(filterRole.value);
    e.target.reset();
  });

  filterRole.addEventListener("change", () => renderUsers(filterRole.value));

  function deleteUser(index) {
    if (confirm("Delete this user?")) {
      const users = getUsers();
      users.splice(index, 1);
      setUsers(users);
      renderUsers(filterRole.value);
    }
  }

  function editUser(index) {
    const users = getUsers();
    const u = users[index];
    const name = prompt("Enter new name", u.name);
    const cnic = prompt("Enter new CNIC", u.cnic);
    const role = prompt("Enter new role", u.role);

    if (name && cnic && role) {
      users[index] = { ...u, name, cnic, role };
      setUsers(users);
      renderUsers(filterRole.value);
    }
  }

  // Initialize with default users if not present
  if (!localStorage.getItem("users")) {
    setUsers([
      { name: "Asad", cnic: "34501-8971113-7", password: "Asad@2723", role: "admin" },
      { name: "Sana", cnic: "35202-1234567-1", password: "sana123", role: "receptionist" },
      { name: "Ali", cnic: "35301-7654321-9", password: "ali123", role: "technician" }
    ]);
  }

  renderUsers();
</script>
