<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Dashboard - Alpha Med</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="storage.js"></script>

  <!-- Access control for Admin only -->
  <script>
    const user = JSON.parse(localStorage.getItem("currentUser"));
    if (!user || user.role !== "Admin") {
      alert("❌ Access Denied. Only Admin can access this page.");
      window.location.href = "login.html";
    }
  </script>
</head>
<body class="bg-gray-100 text-gray-800 p-6 min-h-screen">

  <!-- Header -->
  <header class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold text-blue-700">🧪 Alpha Med Admin Dashboard</h1>
    <a href="login.html" class="text-red-600 hover:underline text-sm">Logout</a>
  </header>

  <!-- Dashboard Summary -->
  <div class="mb-6">
    <h2 class="text-xl font-semibold">📊 Dashboard Summary</h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mt-4" id="summaryContainer">
      <div class="bg-white p-4 rounded shadow text-center">Coming Soon...</div>
    </div>
  </div>

  <!-- Quick Links -->
  <div class="mb-10">
    <h2 class="text-lg font-semibold mb-2">🔗 Quick Access</h2>
    <ul class="space-y-2 text-blue-700 text-sm">
      <li><a href="manage_users.html" class="hover:underline">👤 Manage Users</a></li>
      <li><a href="settings.html" class="hover:underline">⚙️ Settings</a></li>
      <li><a href="export.html" class="hover:underline">📁 Export Data</a></li>
      <li><a href="reception_dashboard.html" class="hover:underline">📝 Patient Entries</a></li>
      <li><a href="view_reports.html" class="hover:underline">📄 View Reports</a></li>
    </ul>
  </div>

  <!-- Lab Info Settings -->
  <section class="mb-10">
    <h2 class="text-xl font-semibold mb-4">🛠 Lab Settings</h2>
    <div class="grid md:grid-cols-3 gap-4">
      <input id="labName" type="text" placeholder="Lab Name" class="input">
      <input id="email" type="email" placeholder="Email" class="input">
      <input id="phone" type="text" placeholder="Phone" class="input">
    </div>
    <div class="mt-3 flex gap-3">
      <button onclick="saveSettings()" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">💾 Save</button>
      <button onclick="resetSettings()" class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600">🔄 Reset</button>
    </div>
  </section>

  <!-- Add New User -->
  <section class="mb-10">
    <h2 class="text-xl font-semibold mb-4">👤 Add New User</h2>
    <div class="grid md:grid-cols-4 gap-4">
      <input id="username" type="text" placeholder="Username" class="input">
      <input id="password" type="password" placeholder="Password" class="input">
      <select id="role" class="input">
        <option value="">Select Role</option>
        <option value="Admin">Admin</option>
        <option value="Reception">Reception</option>
        <option value="Technician">Technician</option>
      </select>
      <div class="flex gap-2">
        <button onclick="addUser()" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">➕ Add</button>
        <button onclick="resetUserFields()" class="px-4 py-2 bg-yellow-500 text-white rounded hover:bg-yellow-600">🔄 Reset</button>
      </div>
    </div>
  </section>

  <!-- User List -->
  <section>
    <h2 class="text-xl font-semibold mb-4">📋 Registered Users</h2>
    <ul id="userList" class="space-y-2"></ul>
    <button onclick="deleteAllUsers()" class="mt-4 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">
      🗑 Delete All Users
    </button>
  </section>

  <style>
    .input {
      @apply border border-gray-300 rounded px-3 py-2 w-full;
    }
    .userItem {
      @apply flex justify-between items-center bg-white p-3 rounded shadow;
    }
    .userItem span {
      @apply text-gray-800;
    }
    .userItem button {
      @apply text-red-600 hover:underline text-sm;
    }
  </style>

  <script>
    function loadSettings() {
      const saved = JSON.parse(localStorage.getItem("labSettings"));
      if (saved) {
        document.getElementById("labName").value = saved.labName || "";
        document.getElementById("email").value = saved.email || "";
        document.getElementById("phone").value = saved.phone || "";
      }
    }

    function saveSettings() {
      const labName = document.getElementById("labName").value.trim();
      const email = document.getElementById("email").value.trim();
      const phone = document.getElementById("phone").value.trim();

      if (!labName || !email || !phone) {
        alert("⚠️ All lab settings fields are required.");
        return;
      }

      localStorage.setItem("labSettings", JSON.stringify({ labName, email, phone }));
      alert("✅ Lab settings saved successfully.");
    }

    function resetSettings() {
      document.getElementById("labName").value = "";
      document.getElementById("email").value = "";
      document.getElementById("phone").value = "";
    }

    function showUsers() {
      const users = JSON.parse(localStorage.getItem("users")) || [];
      const userList = document.getElementById("userList");
      userList.innerHTML = "";

      users.forEach((user, index) => {
        const li = document.createElement("li");
        li.className = "userItem";
        li.innerHTML = `
          <span>${user.username} (${user.role})</span>
          <button onclick="deleteUser(${index})">Delete</button>
        `;
        userList.appendChild(li);
      });
    }

    function addUser() {
      const username = document.getElementById("username").value.trim();
      const password = document.getElementById("password").value.trim();
      const role = document.getElementById("role").value;

      if (!username || !password || !role) {
        alert("⚠️ All user fields are required.");
        return;
      }

      const users = JSON.parse(localStorage.getItem("users")) || [];

      if (users.some(u => u.username === username)) {
        alert("❌ Username already exists.");
        return;
      }

      users.push({ username, password, role });
      localStorage.setItem("users", JSON.stringify(users));
      alert("✅ User added successfully.");
      resetUserFields();
      showUsers();
    }

    function resetUserFields() {
      document.getElementById("username").value = "";
      document.getElementById("password").value = "";
      document.getElementById("role").value = "";
    }

    function deleteUser(index) {
      if (confirm("Are you sure you want to delete this user?")) {
        const users = JSON.parse(localStorage.getItem("users")) || [];
        users.splice(index, 1);
        localStorage.setItem("users", JSON.stringify(users));
        showUsers();
      }
    }

    function deleteAllUsers() {
      if (confirm("⚠️ Delete ALL users? This action cannot be undone.")) {
        localStorage.removeItem("users");
        showUsers();
      }
    }

    window.onload = () => {
      loadSettings();
      showUsers();
    };
  </script>

</body>
</html>
