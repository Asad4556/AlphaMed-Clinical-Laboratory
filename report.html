<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Patient Report - AlphaMed Lab</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      padding: 40px;
      color: #000;
      background-color: #fff;
    }

    h1, h2 {
      text-align: center;
      color: #007b8a;
    }

    .report-section {
      margin-top: 30px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    table, th, td {
      border: 1px solid #444;
    }

    th, td {
      padding: 10px;
      text-align: left;
    }

    th {
      background-color: #e0f7fa;
    }

    .footer {
      margin-top: 40px;
      text-align: center;
      font-size: 12px;
      color: gray;
    }

    .btn-print {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 10px 20px;
      background: #007b8a;
      color: #fff;
      border: none;
      cursor: pointer;
      border-radius: 5px;
    }

    @media print {
      .btn-print {
        display: none;
      }
    }
  </style>
</head>
<body>
  <button class="btn-print" onclick="window.print()">üñ®Ô∏è Print</button>

  <h1>AlphaMed Clinical Laboratory</h1>
  <h2>Patient Test Report</h2>

  <div id="patientInfo"></div>
  <div id="reportResults"></div>

  <div class="footer">
    <p>Report generated by AlphaMed Lab System</p>
  </div>

  <script src="test-data.js"></script>
  <script>
    function renderReport() {
      const urlParams = new URLSearchParams(window.location.search);
      const mrn = urlParams.get("mrn");

      const patients = JSON.parse(localStorage.getItem("patients")) || [];
      const patient = patients.find(p => p.mrn === mrn);
      if (!patient) {
        document.body.innerHTML = "<h2>‚ùå Report Not Found</h2>";
        return;
      }

      const infoHTML = `
        <p><strong>Name:</strong> ${patient.name}</p>
        <p><strong>MRN:</strong> ${patient.mrn}</p>
        <p><strong>Gender:</strong> ${patient.gender}</p>
        <p><strong>CNIC:</strong> ${patient.cnic}</p>
        <p><strong>Age:</strong> ${patient.age}</p>
        <p><strong>Date:</strong> ${new Date().toLocaleDateString()}</p>
      `;
      document.getElementById("patientInfo").innerHTML = infoHTML;

      let resultHTML = "";

      patient.section.forEach(section => {
        const tests = testData[section];
        if (!tests) return;

        resultHTML += `<div class="report-section"><h3>${section}</h3>`;
        resultHTML += `<table>
          <tr>
            <th>Test</th>
            <th>Result</th>
            <th>Normal Range</th>
          </tr>`;

        tests.forEach(test => {
          const res = patient.results?.[test.test] || "‚Äî";
          resultHTML += `
            <tr>
              <td>${test.test}</td>
              <td>${res}</td>
              <td>${test.normal}</td>
            </tr>
          `;
        });

        resultHTML += `</table></div>`;
      });

      document.getElementById("reportResults").innerHTML = resultHTML;
    }

    renderReport();
  </script>
</body>
</html>
