<!DOCTYPE html>
<html lang="ur">
<head>
  <meta charset="UTF-8">
  <title>رپورٹ - AlphaMed</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .report-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .report-header img {
      height: 60px;
    }
    .report-section {
      background: #1e1e1e;
      padding: 20px;
      border-radius: 10px;
    }
    .highlight-high {
      color: #ff5555;
      font-weight: bold;
    }
    .highlight-low {
      color: #ffaa00;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="report-header">
    <img src="logo.png" alt="Logo">
    <div>
      <h2 style="margin: 0; color: #00ffaa;">AlphaMed Clinical Laboratory</h2>
      <p id="date"></p>
    </div>
  </div>

  <div class="report-section">
    <h3>رپورٹ تفصیل</h3>
    <p><strong>MRN:</strong> <span id="mrn"></span></p>
    <p><strong>نام:</strong> <span id="name"></span></p>
    <p><strong>CNIC:</strong> <span id="cnic"></span></p>
    <p><strong>فون نمبر:</strong> <span id="phone"></span></p>
    <p><strong>ایڈریس:</strong> <span id="address"></span></p>

    <h4>ٹیسٹ کی فہرست:</h4>
    <table>
      <thead>
        <tr>
          <th>ٹیسٹ</th>
          <th>ریزلٹ</th>
          <th>نارمل رینج</th>
        </tr>
      </thead>
      <tbody id="resultTable"></tbody>
    </table>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const mrn = params.get("mrn");
    document.getElementById("mrn").innerText = mrn;
    document.getElementById("date").innerText = new Date().toLocaleDateString();

    const patients = JSON.parse(localStorage.getItem("patientList") || "[]");
    const patient = patients.find(p => p.mrn === mrn);
    const reports = JSON.parse(localStorage.getItem("labReports") || "[]");
    const report = reports.find(r => r.mrn === mrn);

    if (patient) {
      document.getElementById("name").innerText = patient.name;
      document.getElementById("cnic").innerText = patient.cnic;
      document.getElementById("phone").innerText = patient.phone;
      document.getElementById("address").innerText = patient.address;
    }

    if (report && report.results) {
      const tbody = document.getElementById("resultTable");
      report.results.forEach(r => {
        let highlightClass = "";
        const resultVal = parseFloat(r.result);
        const normal = r.normal.split("-").map(n => parseFloat(n));
        if (!isNaN(resultVal) && normal.length === 2) {
          if (resultVal < normal[0]) highlightClass = "highlight-low";
          else if (resultVal > normal[1]) highlightClass = "highlight-high";
        }
        tbody.innerHTML += `
          <tr>
            <td>${r.test}</td>
            <td class="${highlightClass}">${r.result}</td>
            <td>${r.normal}</td>
          </tr>
        `;
      });
    }
  </script>
</body>
</html>
