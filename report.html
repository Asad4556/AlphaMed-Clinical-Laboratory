<!DOCTYPE html>
<html lang="ur">
<head>
  <meta charset="UTF-8">
  <title>رپورٹ</title>
  <style>
    body {
      direction: rtl;
      font-family: 'Noto Naskh Arabic', sans-serif;
      background-color: white;
      color: #000;
      padding: 40px;
      position: relative;
    }
    .header {
      text-align: center;
      margin-bottom: 20px;
    }
    .header img {
      width: 80px;
      vertical-align: middle;
    }
    .header h2 {
      display: inline-block;
      margin: 0 10px;
      color: #0d47a1;
    }
    .watermark {
      position: absolute;
      top: 40%;
      left: 50%;
      transform: translate(-50%, -50%);
      opacity: 0.1;
      z-index: 0;
      pointer-events: none;
    }
    .watermark img {
      width: 300px;
    }
    .patient-info {
      position: relative;
      z-index: 1;
      background-color: #f5f5f5;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
    }
    .lab-left {
      float: left;
      font-weight: bold;
      margin-top: 10px;
      color: #0d47a1;
    }
    .report-section {
      position: relative;
      z-index: 1;
      text-align: center;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    th, td {
      border: 1px solid #888;
      padding: 10px;
    }
    th {
      background-color: #e0e0e0;
    }
    .note {
      margin-top: 40px;
      font-size: 12px;
      text-align: center;
      color: #555;
    }
  </style>
</head>
<body>
  <div class="header">
    <img src="logo.png" alt="Lab Logo">
    <h2>AlphaMed Clinical Laboratory</h2>
  </div>

  <div class="watermark">
    <img src="logo.png" alt="Watermark">
  </div>

  <div class="patient-info" id="patientInfo">
    <!-- مریض کی معلومات یہاں لوڈ ہوگی -->
  </div>

  <div class="lab-left">AlphaMed Clinical Lab</div>

  <div class="report-section" id="testResults">
    <!-- ٹیسٹ کی معلومات یہاں لوڈ ہوگی -->
  </div>

  <div class="note">This report is computer generated and does not require signature.</div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const mrn = urlParams.get("mrn");

    const patients = JSON.parse(localStorage.getItem("patientList") || "[]");
    const results = JSON.parse(localStorage.getItem("testResults") || "[]");

    const patient = patients.find(p => p.mrn === mrn);
    const patientResults = results.filter(r => r.mrn === mrn);

    if (patient) {
      document.getElementById("patientInfo").innerHTML = `
        <p><strong>نام:</strong> ${patient.fullName}</p>
        <p><strong>CNIC:</strong> ${patient.cnic}</p>
        <p><strong>فون نمبر:</strong> ${patient.phone}</p>
        <p><strong>MRN:</strong> ${patient.mrn}</p>
        <p><strong>سیکشنز:</strong> ${patient.testType.join(", ")}</p>
      `;
    } else {
      document.getElementById("patientInfo").innerText = "مریض کی معلومات نہیں ملیں۔";
    }

    if (patientResults.length > 0) {
      let table = `
        <table>
          <thead>
            <tr>
              <th>ٹیسٹ کا نام</th>
              <th>نارمل ویلیو</th>
              <th>نتیجہ</th>
            </tr>
          </thead>
          <tbody>
      `;
      patientResults.forEach(test => {
        table += `
          <tr>
            <td>${test.testName}</td>
            <td>${test.normalRange}</td>
            <td>${test.result}</td>
          </tr>
        `;
      });
      table += `</tbody></table>`;
      document.getElementById("testResults").innerHTML = table;
    } else {
      document.getElementById("testResults").innerHTML = "<p>ٹیسٹ کے نتائج ابھی شامل نہیں ہوئے۔</p>";
    }
  </script>
</body>
</html>
