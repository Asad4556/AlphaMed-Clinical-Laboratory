<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>View Reports - AlphaMed Clinical Laboratory</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body {
      background-color: #1c1c1c;
      color: #ffffff;
      font-family: 'Segoe UI', sans-serif;
      padding: 20px;
    }

    h1 {
      text-align: center;
      margin-bottom: 20px;
      color: #00ffff;
    }

    .search-bar {
      text-align: center;
      margin-bottom: 20px;
    }

    .search-bar input {
      padding: 10px;
      width: 90%;
      max-width: 400px;
      border-radius: 5px;
      border: none;
      outline: none;
      font-size: 16px;
    }

    .report-container {
      background-color: #2b2b2b;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px #00ffff44;
      margin-bottom: 30px;
      position: relative;
    }

    .report-container h3 {
      color: #00ffff;
    }

    .report-buttons {
      text-align: center;
      margin-top: 20px;
    }

    .report-buttons button {
      padding: 10px 20px;
      margin: 0 10px;
      border: none;
      border-radius: 5px;
      background-color: #00ffff;
      color: #000;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    .report-buttons button:hover {
      background-color: #00cccc;
    }

    .watermark {
      position: absolute;
      top: 40%;
      left: 30%;
      font-size: 60px;
      opacity: 0.05;
      transform: rotate(-30deg);
      color: #00ffff;
      z-index: 0;
      pointer-events: none;
    }

    @media (max-width: 600px) {
      .report-buttons button {
        margin: 5px 0;
        width: 100%;
      }
    }
  </style>
</head>
<body>

  <h1>AlphaMed Lab - Patient Reports</h1>

  <div class="search-bar">
    <input type="text" id="searchInput" placeholder="Enter MRN, Name, or CNIC to search...">
  </div>

  <div id="reportsList">
    <!-- Dynamic reports will appear here -->
  </div>

  <script>
    const searchInput = document.getElementById("searchInput");
    const reportsList = document.getElementById("reportsList");

    const reportsData = JSON.parse(localStorage.getItem("patients")) || [];

    function renderReports(filteredReports) {
      reportsList.innerHTML = "";

      if (!filteredReports.length) {
        reportsList.innerHTML = "<p style='text-align:center;'>No reports found.</p>";
        return;
      }

      filteredReports.forEach(report => {
        const div = document.createElement("div");
        div.className = "report-container";
        div.innerHTML = `
          <div class="watermark">AlphaMed Lab</div>
          <h3>${report.name}</h3>
          <p><strong>MRN:</strong> ${report.mrn}</p>
          <p><strong>CNIC:</strong> ${report.cnic}</p>
          <p><strong>Gender:</strong> ${report.gender}</p>
          <div class="report-buttons">
            <button onclick="viewReport('${report.mrn}')">View</button>
            <button onclick="printReport('${report.mrn}')">Print</button>
          </div>
        `;
        reportsList.appendChild(div);
      });
    }

    function viewReport(mrn) {
      window.location.href = `report.html?mrn=${mrn}`;
    }

    function printReport(mrn) {
      window.open(`report.html?mrn=${mrn}`, '_blank');
    }

    function searchReports(query) {
      const q = query.trim().toLowerCase();
      const filtered = reportsData.filter(r =>
        r.mrn?.toLowerCase().includes(q) ||
        r.name?.toLowerCase().includes(q) ||
        r.cnic?.toLowerCase().includes(q)
      );
      renderReports(filtered);
    }

    // Debounce search to avoid rapid firing
    let debounceTimer;
    searchInput.addEventListener("input", () => {
      clearTimeout(debounceTimer);
      debounceTimer = setTimeout(() => {
        searchReports(searchInput.value);
      }, 300);
    });

    // Initial render
    renderReports(reportsData);
  </script>

</body>
</html>
