<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>View Reports - Alpha-Med Clinical Lab</title>
  <link rel="stylesheet" href="style.css" />
  <script src="storage.js" defer></script>
  <script src="script.js" defer></script>
  <style>
    .report-card {
      border: 1px solid #ddd;
      padding: 15px;
      margin-bottom: 10px;
      border-radius: 8px;
      background-color: #fff;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    }
    .watermark {
      position: fixed;
      top: 45%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 40px;
      color: rgba(0,0,0,0.05);
      z-index: 0;
      pointer-events: none;
    }
    .report-footer {
      text-align: center;
      font-size: 12px;
      margin-top: 40px;
      color: gray;
    }
    @media print {
      .search-section, .print-button {
        display: none;
      }
      .watermark {
        display: block;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Patient Lab Reports</h2>

    <div class="search-section">
      <input type="text" id="searchInput" placeholder="Search by MRN, CNIC or Name" oninput="filterReports()" />
      <select id="deptFilter" onchange="filterReports()">
        <option value="">All Departments</option>
        <option value="Hematology">Hematology</option>
        <option value="Serology">Serology</option>
        <option value="Histopathology">Histopathology</option>
        <option value="Microbiology">Microbiology</option>
        <option value="Biochemistry">Biochemistry</option>
        <option value="Culture Tests">Culture Tests</option>
        <option value="Special Chemistry">Special Chemistry</option>
        <option value="Molecular Biology">Molecular Biology</option>
        <option value="Blood Banking">Blood Banking</option>
      </select>
      <button class="print-button" onclick="window.print()">üñ®Ô∏è Print</button>
    </div>

    <div id="reportList"></div>

    <div class="watermark">Alpha-Med Clinical Lab</div>
    <div class="report-footer">¬© Alpha-Med Clinical Lab ‚Äì This report is system generated</div>
  </div>

  <script>
    function filterReports() {
      const search = document.getElementById('searchInput').value.toLowerCase();
      const dept = document.getElementById('deptFilter').value;
      const reports = JSON.parse(localStorage.getItem('testResults') || '[]');
      const container = document.getElementById('reportList');
      container.innerHTML = '';

      const filtered = reports.filter(r =>
        (!dept || r.department === dept) &&
        (r.mrn.toLowerCase().includes(search) || 
         r.cnic.toLowerCase().includes(search) ||
         r.name.toLowerCase().includes(search))
      );

      if (filtered.length === 0) {
        container.innerHTML = "<p>No reports found.</p>";
        return;
      }

      filtered.forEach(r => {
        const card = document.createElement('div');
        card.className = 'report-card';
        card.innerHTML = `
          <strong>MRN:</strong> ${r.mrn}<br>
          <strong>Name:</strong> ${r.name}<br>
          <strong>CNIC:</strong> ${r.cnic}<br>
          <strong>Department:</strong> ${r.department}<br>
          <strong>Tests:</strong><br>
          <ul>
            ${r.tests.map(t => `<li>${t.name}: ${t.result} ${t.unit || ''}</li>`).join('')}
          </ul>
          <small><em>Date: ${r.date || new Date().toLocaleDateString()}</em></small>
        `;
        container.appendChild(card);
      });
    }

    window.onload = filterReports;
  </script>
</body>
</html>
