<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Reception - Alpha Med</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="labSections.js"></script>
  <script src="reception.js" defer></script>
</head>
<body class="bg-gray-100 p-6">

  <h1 class="text-2xl font-bold mb-6">üè• Reception Panel - Register Patient</h1>

  <!-- Patient Form -->
  <form id="patientForm" class="bg-white p-6 rounded shadow mb-6">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <input type="text" name="name" placeholder="Patient Name" class="border p-2 rounded" required>
      <input type="text" name="fatherName" placeholder="Father Name/S/o" class="border p-2 rounded" required>
      <input type="text" name="cnic" placeholder="CNIC" class="border p-2 rounded" required>
      <input type="text" name="phone" placeholder="Phone No" class="border p-2 rounded">
      <input type="date" name="dob" placeholder="Date of Birth" class="border p-2 rounded" required>
    </div>

    <!-- Auto-generated MRN and Sample No display -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
      <input type="text" id="autoMRN" placeholder="MRN" class="border p-2 rounded bg-gray-100" readonly>
      <input type="text" id="autoSampleNo" placeholder="Sample No" class="border p-2 rounded bg-gray-100" readonly>
    </div>

    <div class="mt-4">
      <label class="block font-semibold mb-1">Select Departments:</label>
      <select id="departmentSelect" multiple class="border p-2 rounded w-full h-48">
        <option value="Hematology">Hematology</option>
        <option value="Serology">Serology</option>
        <option value="Histopathology">Histopathology</option>
        <option value="Microbiology">Microbiology</option>
        <option value="Biochemistry">Biochemistry</option>
        <option value="Culture Tests">Culture Tests</option>
        <option value="Special Chemistry">Special Chemistry</option>
        <option value="Molecular Biology">Molecular Biology</option>
        <option value="Blood Banking">Blood Banking</option>
      </select>
      <p class="text-sm text-gray-500 mt-1">Use Ctrl/Command or drag to select multiple</p>
    </div>

    <div class="mt-4">
      <label class="block font-semibold mb-1">Select Tests:</label>
      <div id="testCheckboxes" class="grid grid-cols-2 gap-2 max-h-64 overflow-y-auto border p-2 rounded bg-gray-50"></div>
    </div>

    <button type="submit" class="mt-4 bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Register Patient</button>
  </form>

  <!-- Patient List -->
  <div class="bg-white p-4 rounded shadow">
    <h2 class="text-xl font-semibold mb-2">üßæ Registered Patients</h2>
    <table class="w-full table-auto">
      <thead>
        <tr class="bg-gray-200 text-left">
          <th class="p-2">MRN</th>
          <th class="p-2">Name</th>
          <th class="p-2">CNIC</th>
          <th class="p-2">Sample No</th>
        </tr>
      </thead>
      <tbody id="patientList"></tbody>
    </table>
  </div>

  <script>
    const departmentTests = {
      "Hematology": ["CBC", "Hemoglobin", "WBC Count", "Platelet Count", "ESR", "Reticulocyte Count"],
      "Serology": ["Widal Test", "CRP", "ASO Titre", "Rheumatoid Factor", "HIV", "HbsAg"],
      "Histopathology": ["Biopsy", "FNAC", "Pap Smear", "Frozen Section"],
      "Microbiology": ["Gram Stain", "AFB", "Culture & Sensitivity", "KOH", "Ziehl Neelsen Stain"],
      "Biochemistry": ["LFT", "RFT", "Glucose", "Uric Acid", "Cholesterol", "Triglycerides", "LDL", "HDL"],
      "Culture Tests": ["Urine Culture", "Blood Culture", "Sputum Culture", "Stool Culture", "Throat Swab"],
      "Special Chemistry": ["HbA1c", "TIBC", "Iron Studies", "Vitamin D", "Vitamin B12"],
      "Molecular Biology": ["PCR", "RT-PCR", "HCV RNA", "HBV DNA", "GeneXpert"],
      "Blood Banking": ["Blood Grouping", "Cross Match", "Coombs Test", "Antibody Screening"]
    };

    document.getElementById("departmentSelect").addEventListener("change", function () {
      const selectedDepartments = Array.from(this.selectedOptions).map(opt => opt.value);
      const testDiv = document.getElementById("testCheckboxes");
      testDiv.innerHTML = "";

      selectedDepartments.forEach(dept => {
        if (departmentTests[dept]) {
          const groupTitle = document.createElement("div");
          groupTitle.className = "col-span-2 font-semibold mt-2 text-blue-700";
          groupTitle.innerText = dept;
          testDiv.appendChild(groupTitle);

          departmentTests[dept].forEach(test => {
            const label = document.createElement("label");
            label.className = "flex items-center space-x-2";

            const checkbox = document.createElement("input");
            checkbox.type = "checkbox";
            checkbox.name = "tests[]";
            checkbox.value = test;

            label.appendChild(checkbox);
            label.appendChild(document.createTextNode(test));
            testDiv.appendChild(label);
          });
        }
      });
    });

    // Auto MRN / Sample No
    document.addEventListener("DOMContentLoaded", () => {
      const getNext = (key, base) => {
        const last = parseInt(localStorage.getItem(key) || base, 10) + 1;
        return last;
      };
      document.getElementById("autoMRN").value = `MRN-${getNext("lastMRN", 1000)}`;
      document.getElementById("autoSampleNo").value = `S-${getNext("lastSample", 5000)}`;
    });
  </script>
</body>
</html>
