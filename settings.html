<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Settings - AlphaMed Clinical Lab</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <h1>⚙️ Settings</h1>
    <nav>
      <a href="admin_dashboard.html">Dashboard</a> |
      <a href="settings.html">Settings</a> |
      <a href="#" id="logoutBtn">Logout</a>
    </nav>
  </header>

  <main>
    <section class="settings-section">
      <h2>Change Password</h2>
      <form id="changePasswordForm">
        <label for="currentPassword">Current Password:</label>
        <input type="password" id="currentPassword" required />

        <label for="newPassword">New Password:</label>
        <input type="password" id="newPassword" required />

        <label for="confirmPassword">Confirm Password:</label>
        <input type="password" id="confirmPassword" required />

        <button type="submit">Update Password</button>
      </form>
    </section>

    <section class="settings-section">
      <h2>System Preferences</h2>
      <label>
        <input type="checkbox" id="darkModeToggle" />
        Enable Dark Mode
      </label>
    </section>
  </main>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const changePasswordForm = document.getElementById("changePasswordForm");

      changePasswordForm.addEventListener("submit", (e) => {
        e.preventDefault();

        const currentPassword = document.getElementById("currentPassword").value.trim();
        const newPassword = document.getElementById("newPassword").value.trim();
        const confirmPassword = document.getElementById("confirmPassword").value.trim();

        let loggedInUser = JSON.parse(localStorage.getItem("loggedInUser"));
        let users = JSON.parse(localStorage.getItem("users")) || [];

        if (!loggedInUser) {
          alert("You are not logged in!");
          return;
        }

        if (loggedInUser.password !== currentPassword) {
          alert("Current password is incorrect!");
          return;
        }

        if (newPassword !== confirmPassword) {
          alert("New passwords do not match!");
          return;
        }

        loggedInUser.password = newPassword;
        const userIndex = users.findIndex(u => u.username === loggedInUser.username);
        if (userIndex !== -1) {
          users[userIndex].password = newPassword;
        }

        localStorage.setItem("loggedInUser", JSON.stringify(loggedInUser));
        localStorage.setItem("users", JSON.stringify(users));

        alert("Password updated successfully!");
        changePasswordForm.reset();
      });

      // Dark mode toggle
      const darkModeToggle = document.getElementById("darkModeToggle");
      darkModeToggle.addEventListener("change", () => {
        document.body.classList.toggle("dark-mode");
      });
    });
  </script>
  <script src="script.js"></script>
</body>
</html>
