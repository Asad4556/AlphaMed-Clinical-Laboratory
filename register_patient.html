<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Register Patient</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen p-6">

  <div class="bg-white p-6 rounded-lg shadow-lg max-w-3xl mx-auto">
    <h2 class="text-2xl font-bold mb-6">ðŸ”¬ Select Lab Sections & Tests</h2>

    <!-- Department Dropdown -->
    <div class="mb-4">
      <label class="block font-medium mb-1">Select Department</label>
      <select id="labDepartment" class="border rounded w-full p-2">
        <option value="">-- Choose Department --</option>
      </select>
    </div>

    <!-- Test Dropdown -->
    <div class="mb-4">
      <label class="block font-medium mb-1">Select Test</label>
      <select id="testName" class="border rounded w-full p-2">
        <option value="">-- Choose Test --</option>
      </select>
    </div>

    <!-- Test Parameters (Optional, if needed) -->
    <div id="parameters" class="bg-gray-50 p-4 rounded hidden">
      <h3 class="font-semibold mb-2">Test Parameters</h3>
      <ul id="parameterList" class="list-disc pl-5 text-sm text-gray-700">
        <!-- Dynamically Filled -->
      </ul>
    </div>
  </div>

  <script src="test-data.js"></script>
  <script>
    const deptSelect = document.getElementById("labDepartment");
    const testSelect = document.getElementById("testName");
    const parameterBox = document.getElementById("parameters");
    const parameterList = document.getElementById("parameterList");

    // Populate Department Dropdown
    labDepartments.forEach(dept => {
      const opt = document.createElement("option");
      opt.value = dept.name;
      opt.textContent = dept.name;
      deptSelect.appendChild(opt);
    });

    // On Department Change, Populate Test Dropdown
    deptSelect.addEventListener("change", () => {
      testSelect.innerHTML = `<option value="">-- Choose Test --</option>`;
      parameterBox.classList.add("hidden");
      const selectedDept = labDepartments.find(d => d.name === deptSelect.value);
      if (selectedDept) {
        selectedDept.tests.forEach(test => {
          const opt = document.createElement("option");
          opt.value = test.name;
          opt.textContent = test.name;
          testSelect.appendChild(opt);
        });
      }
    });

    // On Test Change, Show Parameters
    testSelect.addEventListener("change", () => {
      parameterList.innerHTML = "";
      const selectedDept = labDepartments.find(d => d.name === deptSelect.value);
      if (!selectedDept) return;

      const selectedTest = selectedDept.tests.find(t => t.name === testSelect.value);
      if (!selectedTest || !selectedTest.parameters) {
        parameterBox.classList.add("hidden");
        return;
      }

      selectedTest.parameters.forEach(p => {
        const li = document.createElement("li");
        li.textContent = `${p.name} (Range: ${p.range} ${p.unit})`;
        parameterList.appendChild(li);
      });

      parameterBox.classList.remove("hidden");
    });
  </script>
</body>
</html>
