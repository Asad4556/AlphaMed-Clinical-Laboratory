<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Register Patient - AlphaMed Lab</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body {
      background-color: #121212;
      color: #ffffff;
      font-family: Arial, sans-serif;
      padding: 20px;
    }

    h1 {
      text-align: center;
      color: #00ffff;
    }

    form {
      max-width: 600px;
      margin: auto;
      background-color: #1e1e1e;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px #00ffff44;
    }

    input, select, button {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      background-color: #2c2c2c;
      color: white;
      border: 1px solid #555;
      border-radius: 5px;
    }

    button {
      background-color: #00ffff;
      color: #000;
      font-weight: bold;
      cursor: pointer;
    }

    .test-section {
      margin-top: 20px;
    }

    .test-section h3 {
      margin-bottom: 5px;
      color: #00ffff;
    }

    .test-checkboxes label {
      display: block;
      margin: 2px 0;
    }
  </style>
</head>
<body>
  <h1>Register Patient</h1>

  <form id="registerForm">
    <input type="text" id="name" placeholder="Full Name" required />
    <input type="text" id="cnic" placeholder="CNIC (xxxxx-xxxxxxx-x)" required />
    <input type="number" id="age" placeholder="Age" required />
    <select id="gender" required>
      <option value="">Select Gender</option>
      <option>Male</option>
      <option>Female</option>
      <option>Other</option>
    </select>

    <select id="sectionSelect" required>
      <option value="">Select Test Section</option>
      <option value="Hematology">Hematology</option>
      <option value="Biochemistry">Biochemistry</option>
      <option value="Immunology">Immunology</option>
      <option value="Microbiology">Microbiology</option>
      <option value="Molecular Biology">Molecular Biology</option>
    </select>

    <div class="test-section">
      <h3>Select Tests:</h3>
      <div id="testCheckboxes" class="test-checkboxes"></div>
    </div>

    <button type="submit">Register</button>
  </form>

  <script>
    const testData = {
      Hematology: [
        { name: "CBC", male: "4.5-6.0", female: "4.0-5.5" },
        { name: "ESR", male: "<15 mm/hr", female: "<20 mm/hr" }
      ],
      Biochemistry: [
        { name: "Glucose", male: "70-100 mg/dL", female: "70-100 mg/dL" },
        { name: "Urea", male: "10-50 mg/dL", female: "7-43 mg/dL" }
      ],
      Immunology: [
        { name: "CRP", male: "<10 mg/L", female: "<10 mg/L" },
        { name: "Rheumatoid Factor", male: "<14 IU/mL", female: "<14 IU/mL" }
      ],
      Microbiology: [
        { name: "Urine Culture", male: "Negative", female: "Negative" },
        { name: "Sputum Culture", male: "Negative", female: "Negative" }
      ],
      "Molecular Biology": [
        { name: "COVID PCR", male: "Negative", female: "Negative" },
        { name: "HCV PCR", male: "Negative", female: "Negative" }
      ]
    };

    const sectionSelect = document.getElementById("sectionSelect");
    const testCheckboxes = document.getElementById("testCheckboxes");

    sectionSelect.addEventListener("change", () => {
      const section = sectionSelect.value;
      testCheckboxes.innerHTML = "";
      if (testData[section]) {
        testData[section].forEach((test, index) => {
          const checkbox = document.createElement("input");
          checkbox.type = "checkbox";
          checkbox.id = `test-${index}`;
          checkbox.value = JSON.stringify(test);

          const label = document.createElement("label");
          label.htmlFor = `test-${index}`;
          label.textContent = test.name;

          label.prepend(checkbox);
          testCheckboxes.appendChild(label);
        });
      }
    });

    document.getElementById("registerForm").addEventListener("submit", (e) => {
      e.preventDefault();

      const name = document.getElementById("name").value.trim();
      const cnic = document.getElementById("cnic").value.trim();
      const age = document.getElementById("age").value.trim();
      const gender = document.getElementById("gender").value;
      const section = sectionSelect.value;

      const selectedTests = Array.from(testCheckboxes.querySelectorAll("input:checked")).map(i => JSON.parse(i.value));

      if (!selectedTests.length) {
        return alert("Please select at least one test.");
      }

      const patients = JSON.parse(localStorage.getItem("patients") || "[]");
      const mrn = `ACL-${new Date().getFullYear()}-${String(patients.length + 1).padStart(5, "0")}`;

      patients.push({ mrn, name, cnic, age, gender, testType: section, selectedTests });
      localStorage.setItem("patients", JSON.stringify(patients));

      alert(`Patient registered. MRN: ${mrn}`);
      window.location.href = "reception_dashboard.html";
    });
  </script>
</body>
</html>
