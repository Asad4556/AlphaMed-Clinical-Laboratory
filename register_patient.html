<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Register Patient - AlphaMed Lab</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f4f7fb;
      padding: 20px;
    }

    h2 {
      color: #013243;
      text-align: center;
      margin-bottom: 20px;
    }

    form {
      background: #fff;
      padding: 25px;
      border-radius: 10px;
      max-width: 700px;
      margin: auto;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    label {
      display: block;
      margin: 12px 0 6px;
    }

    input, select {
      width: 100%;
      padding: 10px;
      margin-bottom: 12px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }

    button {
      background-color: #013243;
      color: white;
      padding: 12px 20px;
      border: none;
      border-radius: 5px;
      width: 100%;
      font-size: 16px;
    }

    button:hover {
      background-color: #014a63;
    }

    .qr-preview {
      margin-top: 20px;
      text-align: center;
    }
  </style>
</head>
<body>

  <h2>Register Patient - AlphaMed Clinical Lab</h2>

  <form id="registrationForm">
    <label for="name">Patient Name</label>
    <input type="text" id="name" required />

    <label for="cnic">CNIC</label>
    <input type="text" id="cnic" maxlength="15" placeholder="xxxxx-xxxxxxx-x" required />

    <label for="phone">Phone Number</label>
    <input type="text" id="phone" placeholder="03xxxxxxxxx" required />

    <label for="department">Select Department</label>
    <select id="department" required>
      <option value="">-- Select Department --</option>
      <option>Hematology</option>
      <option>Serology</option>
      <option>Histopathology</option>
      <option>Microbiology</option>
      <option>Biochemistry</option>
      <option>Culture Tests</option>
      <option>Special Chemistry</option>
      <option>Molecular Biology</option>
      <option>Blood Banking</option>
    </select>

    <label for="test">Select Test</label>
    <select id="test" required>
      <option value="">-- Select Test --</option>
    </select>

    <button type="submit">Register & Generate Slip</button>

    <div class="qr-preview" id="qrCodeContainer"></div>
  </form>

  <!-- Required Scripts -->
  <script src="test-data.js"></script>
  <script src="storage.js"></script>
  <script src="qr-generator.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

  <script>
    // Auto fill test dropdown based on department
    document.getElementById("department").addEventListener("change", function() {
      const dept = this.value;
      const testSelect = document.getElementById("test");
      testSelect.innerHTML = "<option value=''>-- Select Test --</option>";

      if (testData[dept]) {
        testData[dept].forEach(test => {
          const opt = document.createElement("option");
          opt.value = test.name;
          opt.textContent = test.name;
          testSelect.appendChild(opt);
        });
      }
    });

    // Form submission
    document.getElementById("registrationForm").addEventListener("submit", function(e) {
      e.preventDefault();

      const patient = {
        mrn: "MRN-" + Date.now(),
        name: document.getElementById("name").value,
        cnic: document.getElementById("cnic").value,
        phone: document.getElementById("phone").value,
        department: document.getElementById("department").value,
        test: document.getElementById("test").value,
        date: new Date().toLocaleString()
      };

      savePatientData(patient); // Save to storage
      localStorage.setItem("latestPatient", JSON.stringify(patient)); // For slip
      generateQRCode(JSON.stringify(patient), "qrCodeContainer");

      setTimeout(() => {
        window.location.href = "registration-slip.html";
      }, 1500);
    });
  </script>

</body>
</html>
