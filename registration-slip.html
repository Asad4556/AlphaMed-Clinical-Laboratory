<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Patient Registration Slip</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="header">
    <h2>Patient Registration Slip</h2>
    <button onclick="logout()">Logout</button>
  </div>

  <div class="container">
    <div class="card" id="slip">
      <h3>AlphaMed Diagnostic Lab</h3>
      <hr>
      <p><b>Patient ID:</b> <span id="pid"></span></p>
      <p><b>Name:</b> <span id="pname"></span></p>
      <p><b>Age:</b> <span id="page"></span></p>
      <p><b>Gender:</b> <span id="pgender"></span></p>
      <p><b>Contact:</b> <span id="pcontact"></span></p>
      <p><b>Date:</b> <span id="pdate"></span></p>
    </div>

    <button class="print-btn" onclick="window.print()">Print Slip</button>
    <button onclick="window.location.href='reception_dashboard.html'">Back to Dashboard</button>
  </div>

  <script>
    function logout() {
      localStorage.removeItem("loggedInUser");
      window.location.href = "login.html";
    }

    // Fetch patient by ID from localStorage
    const urlParams = new URLSearchParams(window.location.search);
    const id = urlParams.get("id");

    let patients = JSON.parse(localStorage.getItem("patients")) || [];
    let patient = patients.find(p => p.id == id);

    if (patient) {
      document.getElementById("pid").textContent = patient.id;
      document.getElementById("pname").textContent = patient.name;
      document.getElementById("page").textContent = patient.age;
      document.getElementById("pgender").textContent = patient.gender;
      document.getElementById("pcontact").textContent = patient.contact;
      document.getElementById("pdate").textContent = patient.date;
    } else {
      alert("Patient not found!");
      window.location.href = "register_patient.html";
    }

    // âœ… Access control
    document.addEventListener("DOMContentLoaded", () => {
      let user = JSON.parse(localStorage.getItem("loggedInUser"));
      if (!user || user.role !== "reception") {
        alert("Access denied!");
        window.location.href = "login.html";
      }
    });
  </script>
</body>
</html>
